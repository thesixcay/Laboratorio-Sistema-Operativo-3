practica 1 

1. Configuraci贸n de NFS (Compartir archivos entre Linux)
En el Servidor:

    Instalar NFS:
    bash

sudo apt update && sudo apt install nfs-kernel-server -y

Crear directorio y archivos:
bash

sudo mkdir /OS3 && for i in {1..100}; do sudo touch /OS3/Adrian${i}.txt; done

Dar permisos:
bash

sudo chown nobody:nogroup /OS3 && sudo chmod 777 /OS3

Configurar exports:
bash

echo "/OS3 *(rw,sync,no_subtree_check)" | sudo tee -a /etc/exports

Reiniciar NFS:
bash

    sudo systemctl restart nfs-kernel-server

En el Cliente:

    Instalar cliente NFS:
    bash

sudo apt update && sudo apt install nfs-common -y

Crear punto de montaje:
bash

sudo mkdir /mnt/os3_shared

Montar manualmente:
bash

sudo mount <IP_SERVIDOR>:/OS3 /mnt/os3_shared

Configurar montaje autom谩tico:
bash

echo "<IP_SERVIDOR>:/OS3 /mnt/os3_shared nfs defaults 0 0" | sudo tee -a /etc/fstab

Probar reinicio:
bash

    sudo reboot && ls /mnt/os3_shared

2. Cifrado con GPG2

    Instalar GPG2:
    bash

sudo apt update && sudo apt install gnupg2 -y

Generar clave GPG:
bash

gpg2 --full-generate-key

(Seguir instrucciones interactivas)

Crear archivo a cifrar:
bash

mkdir ~/seguridad && echo "Mensaje secreto" > ~/seguridad/mensaje.txt

Cifrar archivo:
bash

gpg2 -e -r "tu_email@dominio.com" ~/seguridad/mensaje.txt

Intentar leer archivo cifrado:
bash

cat ~/seguridad/mensaje.txt.gpg

Descifrar archivo:
bash

gpg2 -d ~/seguridad/mensaje.txt.gpg > ~/seguridad/mensaje_descifrado.txt

Ver contenido descifrado:
bash

cat ~/seguridad/mensaje_descifrado.txt
-------------------------------------------------------------------------------------------------------------------------------------

practica 2 

1. Habilitar servicios HTTP, FTP y SSH
Instalar y habilitar servicios
bash

sudo apt update
sudo apt install apache2 vsftpd openssh-server -y
sudo systemctl enable --now apache2 vsftpd ssh

Verificar que funcionan
bash

sudo systemctl status apache2 vsftpd ssh
ss -tulnp | grep -E '80|21|22'

2. Bloquear puertos 80, 21 y 22 con IPTables
Reglas para bloquear tr谩fico
bash

sudo iptables -A INPUT -p tcp --dport 80 -j DROP   # HTTP
sudo iptables -A INPUT -p tcp --dport 21 -j DROP   # FTP
sudo iptables -A INPUT -p tcp --dport 22 -j DROP   # SSH

Verificar reglas
bash

sudo iptables -L INPUT -n --line-numbers

Probar conexi贸n (debe fallar)
bash

curl http://localhost          # HTTP (puerto 80)
ftp localhost                  # FTP (puerto 21)
ssh localhost                  # SSH (puerto 22)

3. Permitir nuevamente puertos 80, 21 y 22 con IPTables
Eliminar reglas de bloqueo
bash

sudo iptables -D INPUT -p tcp --dport 80 -j DROP
sudo iptables -D INPUT -p tcp --dport 21 -j DROP
sudo iptables -D INPUT -p tcp --dport 22 -j DROP

Permitir tr谩fico
bash

sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT

Verificar reglas
bash

sudo iptables -L INPUT -n --line-numbers

Probar conexi贸n (debe funcionar)
bash

curl http://localhost
ftp localhost
ssh localhost

4. Bloquear puertos con UFW (Debian/Ubuntu/Parrot OS)
Habilitar UFW
bash

sudo ufw enable

Bloquear puertos
bash

sudo ufw deny 80/tcp   # HTTP
sudo ufw deny 21/tcp   # FTP
sudo ufw deny 22/tcp   # SSH

Verificar reglas
bash

sudo ufw status numbered

Probar conexi贸n (debe fallar)
bash

curl http://localhost
ftp localhost
ssh localhost

5. Permitir puertos nuevamente con UFW
Permitir tr谩fico
bash

sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 21/tcp   # FTP
sudo ufw allow 22/tcp   # SSH

Verificar reglas
bash

sudo ufw status numbered

Probar conexi贸n (debe funcionar)
bash

curl http://localhost
ftp localhost
ssh localhost

------------------------------------------------------------------------------------------------------------

practica 3 

1. Instalaci贸n de Snort en Parrot OS
bash

# Actualizar e instalar dependencias
sudo apt update
sudo apt install -y snort libpcap-dev

# Verificar versi贸n
snort -V

2. Configuraci贸n B谩sica de Snort
bash

# Editar configuraci贸n principal
sudo nano /etc/snort/snort.conf

# Modificar estas l铆neas:
var HOME_NET [IP_de_tu_ParrotOS]/32   # Ej: 192.168.1.100/32
var EXTERNAL_NET any
ipvar DNS_SERVERS $HOME_NET

3. Creaci贸n de Reglas de Detecci贸n
bash

# Crear archivo de reglas locales
sudo nano /etc/snort/rules/local.rules

Agregar las siguientes reglas:
plaintext

# Detecci贸n de ICMP (Ping)
alert icmp any any -> $HOME_NET any (msg:"ICMP Ping Detectado"; sid:1000001; rev:1;)

# Detecci贸n de tr谩fico FTP (puerto 21)
alert tcp any any -> $HOME_NET 21 (msg:"Tr谩fico FTP Detectado"; sid:1000002; rev:1;)

# Detecci贸n de tr谩fico SSH (puerto 22)
alert tcp any any -> $HOME_NET 22 (msg:"Tr谩fico SSH Detectado"; sid:1000003; rev:1;)

# Detecci贸n de tr谩fico HTTP (puerto 80)
alert tcp any any -> $HOME_NET 80 (msg:"Tr谩fico HTTP Detectado"; sid:1000004; rev:1;)

4. Ejecuci贸n de Snort en Modo IDS
bash

# Verificar configuraci贸n
sudo snort -T -c /etc/snort/snort.conf

# Ejecutar en modo IDS (reemplaza 'eth0' con tu interfaz de red)
sudo snort -A console -q -c /etc/snort/snort.conf -i eth0 -l /var/log/snort/

5. Pruebas desde Windows 11
Prueba 1: Detecci贸n de Ping (ICMP)
powershell

# En Windows (PowerShell o CMD):
ping [IP_de_ParrotOS]

Salida esperada en Snort:
text

[**] [1:1000001:1] ICMP Ping Detectado [**]
[Priority: 0] 
{ICMP} 192.168.1.50 -> 192.168.1.100

Prueba 2: Detecci贸n de FTP (Puerto 21)
powershell

# Usar telnet para probar conexi贸n FTP
telnet [IP_de_ParrotOS] 21

Salida esperada en Snort:
text

[**] [1:1000002:1] Tr谩fico FTP Detectado [**]
[Priority: 0] 
{TCP} 192.168.1.50:51234 -> 192.168.1.100:21

Prueba 3: Detecci贸n de SSH (Puerto 22)
powershell

# Usar telnet para probar conexi贸n SSH
telnet [IP_de_ParrotOS] 22

Salida esperada en Snort:
text

[**] [1:1000003:1] Tr谩fico SSH Detectado [**]
[Priority: 0] 
{TCP} 192.168.1.50:51235 -> 192.168.1.100:22

Prueba 4: Detecci贸n de HTTP (Puerto 80)
powershell

# Usar curl o navegador web
curl http://[IP_de_ParrotOS]

Salida esperada en Snort:
text

[**] [1:1000004:1] Tr谩fico HTTP Detectado [**]
[Priority: 0] 
{TCP} 192.168.1.50:51236 -> 192.168.1.100:80

6. Visualizaci贸n de Alertas
bash

# Ver alertas en tiempo real (en otra terminal)
sudo tail -f /var/log/snort/alert

7. Detener Snort
bash

# Para detener Snort
sudo pkill snort

Resumen de Configuraci贸n
Protocolo	Puerto	Regla Snort	Prueba Windows
ICMP	-	alert icmp any any -> $HOME_NET any	ping [IP]
FTP	21	alert tcp any any -> $HOME_NET 21	telnet [IP] 21
SSH	22	alert tcp any any -> $HOME_NET 22	telnet [IP] 22
HTTP	80	alert tcp any any -> $HOME_NET 80	curl http://[IP]

Consejos:

    Aseg煤rate que los servicios (FTP/SSH/HTTP) est谩n corriendo en Parrot OS

    Verifica que no hay reglas de firewall bloqueando el tr谩fico

    Para pruebas m谩s reales, puedes usar Nmap desde Windows:
    powershell

nmap -p 21,22,80 [IP_de_ParrotOS]
------------------------------------------------------------------------------------------------------------------

practica 4 

1. Instalaci贸n de Google Authenticator en Parrot OS/Ubuntu
bash

sudo apt update
sudo apt install libpam-google-authenticator -y

2. Configuraci贸n para el Usuario

    Ejecutar el asistente de configuraci贸n (como usuario normal, NO root):
    bash

    google-authenticator

    Seguir las instrucciones interactivas:

        驴Generar tokens basados en tiempo? (S铆)

        Guardar el c贸digo de emergencia (en un lugar seguro)

        驴Actualizar el archivo ~/.google_authenticator? (S铆)

        驴Permitir m煤ltiples usos del mismo c贸digo? (No, por seguridad)

        驴Limitar ventana de verificaci贸n? (S铆)

        驴Habilitar protecci贸n contra fuerza bruta? (S铆)

    Configurar el c贸digo QR en Google Authenticator (app m贸vil):

        Escanear el QR mostrado en terminal.

        O ingresar manualmente la clave secreta.

3. Configurar PAM para usar Google Authenticator

    Editar el archivo PAM para SSH:
    bash

sudo nano /etc/pam.d/sshd

Agregar al inicio del archivo:
plaintext

auth required pam_google_authenticator.so

Comentar (si existe) la l铆nea:
plaintext

    @include common-auth

    (para evitar doble solicitud de contrase帽a).

4. Configurar SSH para usar 2FA

    Editar la configuraci贸n de SSH:
    bash

sudo nano /etc/ssh/sshd_config

Asegurar estas l铆neas est茅n as铆:
plaintext

ChallengeResponseAuthentication yes
UsePAM yes
PasswordAuthentication yes  # (Si usas contrase帽a + 2FA)

Reiniciar SSH:
bash

    sudo systemctl restart sshd

5. Prueba de Acceso desde Windows 11 (Host)
Opci贸n 1: Usar PuTTY (Recomendado)

    Abrir PuTTY y configurar:

        Host Name: [IP_de_tu_VM]

        Connection > SSH > Auth:

            Habilitar "Keyboard-interactive".

    Conectar:

        Primero pedir谩 usuario.

        Luego contrase帽a.

        Finalmente, el c贸digo de Google Authenticator (6 d铆gitos).

Opci贸n 2: Usar PowerShell/CMD
powershell

ssh usuario@[IP_de_tu_VM]

    Secuencia de autenticaci贸n:

        Ingresar contrase帽a.

        Ingresar c贸digo de 6 d铆gitos (app m贸vil).

6. Soluci贸n de Problemas Comunes
 Error: "Permission denied (keyboard-interactive)"

    Verifica que en /etc/ssh/sshd_config est茅:
    plaintext

    ChallengeResponseAuthentication yes
    UsePAM yes

 No se solicita el c贸digo 2FA

    Revisa que /etc/pam.d/sshd tenga:
    plaintext

    auth required pam_google_authenticator.so

 C贸digo no funciona

    Verifica sincronizaci贸n de tiempo en la VM:
    bash

    sudo apt install ntpdate
    sudo ntpdate pool.ntp.org

7. Desactivar 2FA (Opcional)

    Eliminar el archivo de configuraci贸n:
    bash

rm ~/.google_authenticator

Revertir cambios en PAM:
bash

sudo nano /etc/pam.d/sshd

    Eliminar pam_google_authenticator.so.

    Descomentar @include common-auth.

Reiniciar SSH:
bash

sudo systemctl restart sshd
